# Bacpac GUI

Cross-platform desktop utility for SQL Server `.bacpac` backup and restore workflows, built with **.NET 10** + **Avalonia**.

## Features

- Backup tab
  - SQL Server login (`Server`, `Username`, `Password`)
  - Load and pick available databases
  - Folder picker that auto-generates output file names like `Database-YYYYMMDD-HHMM.bacpac`
  - Start/Cancel backup
  - Live operation log with copy/clear/open-folder actions
- Restore tab
  - `.bacpac` file picker
  - SQL Server login (`Server`, `Username`, `Password`)
  - Restore into an existing database or create a new one
  - Auto-suggest new DB name from selected `.bacpac` filename
  - Start/Cancel restore
  - Live operation log with copy/clear/open-folder actions

## Tech Stack

- .NET 10 (`net10.0`)
- Avalonia UI 11
- CommunityToolkit.Mvvm
- Microsoft SqlClient
- Microsoft SqlServer DacFx (in-process)
- Microsoft.Extensions.DependencyInjection

## Project Structure

- `BacpacGUI.App/ViewModels` - MVVM view models (`BackupViewModel`, `RestoreViewModel`, `MainWindowViewModel`)
- `BacpacGUI.App/Services` - DacFx operations, file/folder pickers, clipboard and file-manager integration
- `BacpacGUI.App/MainWindow.axaml` - tabbed backup/restore UI
- `scripts/` - packaging scripts
- `Makefile` - convenience commands

## Prerequisites

- .NET SDK 10.0+
- Access to SQL Server with SQL authentication
- Network access to restore NuGet packages on first build

## Run Locally

```bash
make build
make run
```

Equivalent direct commands:

```bash
dotnet build BacpacGUI.sln -p:UsedAvaloniaProducts=
dotnet run --project BacpacGUI.App/BacpacGUI.App.csproj -p:UsedAvaloniaProducts=
```

## Package for Distribution

```bash
make publish
```

## Releases

Prebuilt artifacts are published on GitHub Releases:

- https://github.com/brooklynDev/Bacpac-GUI/releases

This runs:

- `scripts/package-macos.sh`
  - Creates self-contained macOS app bundles (Apple Silicon + Intel)
  - Outputs zip files to `artifacts/macos`
- `scripts/package-windows.sh`
  - Creates self-contained Windows x64 package
  - Outputs zip file to `artifacts/windows`

### Notes

- Packaging scripts publish with `PublishSingleFile=false` intentionally.
  - DacFx can fail at runtime with single-file publish due assembly-origin/version resolution.
- If a restore for a RID requires downloading runtime packs, `dotnet publish` needs internet access.

## macOS Distribution Notes

Unsigned apps may be blocked by Gatekeeper on recipient machines.

If needed, users can remove quarantine attributes after download:

```bash
xattr -dr com.apple.quarantine "Bacpac GUI (Apple Silicon).app"
```

For production distribution, code signing + notarization is recommended.

## SQL Connection Behavior

Connections are built with:

- `Encrypt=true`
- `TrustServerCertificate=true`

Database list loading queries user databases from `sys.databases` (excluding system DBs).

## Troubleshooting

### `The value cannot be an empty string. (Parameter 'path')` during backup

This is commonly caused by single-file publish with DacFx. Use builds/packages generated by the included scripts (`PublishSingleFile=false`).

### `NU1301` / unable to contact `api.nuget.org`

Your environment cannot reach NuGet. Restore/publish again once network access is available.

### App opens but file/folder selection is not working on macOS

Use the current picker implementation in this repo (already uses Avalonia `StorageProvider` patterns compatible with recent macOS behavior).

## Development

This app follows MVVM; business logic stays in view models/services, not code-behind.

- DI setup: `BacpacGUI.App/Program.cs`
- DacFx service: `BacpacGUI.App/Services/SqlPackageService.cs`

## License

Internal use.
